<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Easing functions</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Lobster|Montserrat" rel="stylesheet">
        <style>

            #slider-container {
                overflow: hidden;
            }
            #slider {
                position: relative;
                left: 0;
                height: 160px;
                width: 120px;
            }

            html {
                position: relative;
                min-height: 100%;
            }

            body {
                font-family: Montserrat, sans-serif;
                margin-bottom: 60px;
            }

            body, button, h1, h2, h3 {
                color: #fff;
            }

            a, a:focus, a:hover {
                color: #5bc0de;
                text-decoration: underline;
            }

            a:focus, a:hover {
                color: #fff;
            }

            button, h1, h2, h3 {
                font-family: Lobster, sans-serif;
            }

            hr {
                background-color: #636c72;
            }

            .footer {
                position: absolute;
                bottom: 0;
                width: 100%;
                height: 60px;
                line-height: 60px;
                background-color: #f5f5f5;
            }
        </style>
    </head>
<body class="bg-inverse">
    <div class="container">
        <div class="row mt-4">
            <div class="col-md-12 text-center">
                <img src="../../../images/728x90-1.png" class="mb-4"/>
                <hr class="mt-4"/>
                <h1>Easing functions</h1>
                <hr class="mt-4"/>
            </div>
        </div>
        <div class="row mb-5">
            <div class="col-md-12 text-muted">
                <div id="slider-container">
                    <div id="slider">
                        <svg width="120" height="200">
                            <text x="60" y="160" font-size="10px" fill="#636c72">time</text>
                            <line x1="0" y1="0" x2="0" y2="160" stroke-width="1" stroke="#636c72"/>
                            <line x1="0" y1="20" x2="120" y2="20" stroke-width="1" stroke="#636c72"/>
                            <line x1="0" y1="140" x2="120" y2="140" stroke-width="1" stroke="#636c72"/>
                            <path id="curve" d="M 0 0" stroke="#f0ad4e" stroke-width="2" fill="transparent"/>
                        </svg>
                    </div>
                </div>
                <div id="easing"></div>
                <div>Fps: ~60</div>
                <div>Duration: <span id="duration">&infin;</span> second(s)</span></div>
                <div>Frame: <span id="frames">&infin;</span></div>
                <div>Factor: <span id="factor">&infin;</span></div>
            </div>
        </div>       
        <div class="row mb-5 mt-5">
            <div class="col-md-12 text-center">
                <button class="btn btn-lg btn-secondary" onclick="window.run();">Run!</button>
            </div>
        </div>
        <div class="row mt-5 text-center text-md-left">
            <div class="col-md-4">
                <p>This is a demo for compact easing functions written with Javascript ES6 syntax, inspired by and adapted from <a href="http://robertpenner.com/easing/">Robert Penner's easing equations</a>.</p>
            </div>
            <div class="col-md-4">
                <p>To run the demo you need a browser with ES6 support, for instance Chrome or Firefox.</p>
            </div>
            <div class="col-md-4">
                <p>The code is licensed with the MIT license.</p>
            </div>
        </div>
        <div class="row mt-5 text-center text-md-left">
            <div class="col-md-4">
                <img src="../../../images/300x250-1.png" class="mb-4"/>
            </div>
            <div class="col-md-4">
                <img src="../../../images/300x250-2.png" class="mb-4"/>
            </div>
            <div class="col-md-4">
                <img src="../../../images/300x250-1.png" class="mb-4"/>
            </div>
        </div>
    </div>

    <footer class="footer bg-inverse">
        <div class="container text-muted text-center">
            &copy; 2017 Erik Barke
        </div>
    </footer>
</body>
</html>

<script>

    const easeIn = (t, p) => Math.pow(t, p);
    const easeOut = (t, p) => 1 - easeIn(1 - t, p);
    const easeInOut = (t, p) => t < 0.5 ? easeIn(t * 2, p) / 2 : easeOut(t * 2 - 1, p) / 2 + 0.5;

    const easeInSine = (t) => 1 - Math.cos(t * Math.PI / 2);
    const easeOutSine = (t) => 1 - easeInSine(1 - t);
    const easeInOutSine = (t) => t < 0.5 ? easeInSine(t * 2) / 2 : easeOutSine(t * 2 - 1) / 2 + 0.5;

    const easeInCircular = (t) => 1 - Math.sqrt(1 - Math.pow(t, 3));
    const easeOutCircular = (t) => 1 - easeInCircular(1 - t);
    const easeInOutCircular = (t) => t < 0.5 ? easeInCircular(t * 2) / 2 : easeOutCircular(t * 2 - 1) / 2 + 0.5;

    const easeInElastic = (t) => - Math.pow(2, 10 * (t -= 1)) * Math.sin((t - 0.4 / 4) * (2 * Math.PI) / 0.4);
    const easeOutElastic = (t) => 1 - easeInElastic(1 - t);
    const easeInOutElastic = (t) => t < 0.5 ? easeInElastic(t * 2) / 2 : easeOutElastic(t * 2 - 1) / 2 + 0.5;

    const easeInBack = (t) => t * t * (2.7 * t - 1.7);
    const easeOutBack = (t) => 1 - easeInBack(1 - t);
    const easeInOutBack = (t) => t < 0.5 ? easeInBack(t * 2) / 2 : easeOutBack(t * 2 - 1) / 2 + 0.5;

    const easing = easeInOutElastic;
    const fps = 60;
    const duration = 2;

    const frames = (1000 * duration) / (1000 / fps);
    const container = document.querySelector("#slider-container");
    const slider = document.querySelector("#slider");

    const easingElement = document.querySelector("#easing");
    const durationElement = document.querySelector("#duration");
    const frameElement = document.querySelector("#frames");
    const factorElement = document.querySelector("#factor");

    let tweens;
    let frame;
    let path;

    easingElement.innerHTML = easing.name;
    durationElement.innerHTML = duration;

    let draw = () => {
        if(frame < frames) {
            let t = (frame / fps) / duration;
            let factor = easing(t, 3);
            let destination = container.offsetWidth - slider.offsetWidth;
            slider.style.left = factor * destination + "px";
            frameElement.innerHTML = frame + 1;
            factorElement.innerHTML = factor;
            frame++;
            requestAnimationFrame(draw);
        }
    };

    window.run = () => {
        frame = 0;
        tweens = [];
        path = "";

        for(let f = 0; f < frames; f++) {
            let t = (f / fps) / 2;
            let factor = easing(t, 3);
            tweens.push(factor);
        }

        tweens.reverse();

        for(let i = 0; i < tweens.length; i++) {
            path += (i === 0 ? "M" : "L");
            path += i + " " + ((tweens[i] * 120) + 20);
        }

        let svgPath = document.querySelector("#curve");
        svgPath.setAttribute("d", path);
        
        slider.style.left = "0px";
        draw();
    };

    window.run();

</script>

</html>